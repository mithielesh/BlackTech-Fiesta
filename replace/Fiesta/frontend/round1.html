<!DOCTYPE html>
<html>
<head>
<title>Round 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:"Segoe UI",Arial;
    background:linear-gradient(135deg,#0f172a,#1e1b4b);
    color:white;
}

.header{
    background:#111827;
    padding:15px 25px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.4);
}

.title{
    font-size:22px;
    font-weight:bold;
    color:#60a5fa;
}

.timer{
    background:#1e293b;
    padding:8px 18px;
    border-radius:25px;
    border:2px solid #3b82f6;
    font-weight:bold;
}

.container{
    width:90%;
    max-width:900px;
    margin:40px auto;
}

.card{
    background:#1e293b;
    padding:25px;
    border-radius:16px;
    margin-bottom:25px;
    box-shadow:0 10px 25px rgba(0,0,0,0.5);
}

input{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:2px solid transparent;
    background:#0f172a;
    color:white;
    font-size:16px;
    margin-top:12px;
    transition:0.3s;
}

input:focus{
    outline:none;
    border:2px solid #3b82f6;
    box-shadow:0 0 8px #3b82f6;
}

button{
    margin-top:15px;
    background:linear-gradient(90deg,#3b82f6,#2563eb);
    padding:12px 25px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:white;
    font-weight:bold;
    transition:0.3s;
}

button:hover{
    transform:scale(1.05);
    box-shadow:0 5px 15px rgba(59,130,246,0.4);
}

.output-box{
    margin-top:20px;
    padding:18px;
    background:#0f172a;
    border-radius:12px;
    font-size:18px;
    color:#38bdf8;
    border-left:4px solid #3b82f6;
}

textarea{
    width:100%;
    height:150px;
    padding:15px;
    border-radius:12px;
    border:2px solid transparent;
    background:#0f172a;
    color:white;
    font-size:15px;
    margin-top:10px;
    resize:none;
    transition:0.3s;
}

textarea:focus{
    outline:none;
    border:2px solid #3b82f6;
    box-shadow:0 0 8px #3b82f6;
}

.submit-btn{
    margin-top:18px;
}
.instructions{
    background:#0f172a;
    padding:18px;
    border-radius:12px;
    margin-bottom:20px;
    font-size:14px;
    line-height:1.6;
    border-left:4px solid #facc15;
}
.instructions h4{
    margin:0 0 10px 0;
    color:#facc15;
}
/* üîµ RESULT MODAL */
.modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.65);
    justify-content:center;
    align-items:center;
    z-index:1000;
}

.modal-content{
    background:#1e293b;
    padding:30px;
    border-radius:16px;
    width:350px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    animation:fadeIn 0.3s ease;
}

.modal-content h3{
    margin-bottom:10px;
}

.modal-content p{
    color:#cbd5e1;
    margin-bottom:20px;
}


.modal-cancel{
    background:#64748b;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    cursor:pointer;
    color:white;
}

.modal-confirm{
    background:#3b82f6;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    cursor:pointer;
    color:white;
}

.modal-confirm:hover{
    background:#2563eb;
}

@keyframes fadeIn{
    from{opacity:0; transform:scale(0.9);}
    to{opacity:1; transform:scale(1);}
}

</style>
</head>
<body>

<div class="header">
    <div class="title">üíª ROUND 1</div>
    <div class="timer" id="timer">‚è±Ô∏è Loading...</div>
</div>

<div class="container">

    <div class="card">

        <div class="instructions">
            <h4>‚ö† Instructions</h4>
            ‚Ä¢ Use variable <b>x</b> for single input problems.<br>
            ‚Ä¢ Use variables <b>x</b> and <b>y</b> for two-input problems.<br>
            ‚Ä¢ Do NOT use console.log or extra statements.<br>
            ‚Ä¢ Write only the mathematical expression (like x+y or x*y).<br>
            ‚Ä¢ Use parenthesis for functions if requied. Sample: <code>factorial(x,y)</code><br>
        </div>

        <h2>üî¢ Test Your Input</h2>

        <input type="number" id="input1" placeholder="Enter first number (x)">

        <input type="number" id="input2"
               placeholder="Enter second number (y)"
               style="display:none;">

        <button onclick="generateOutput()">Generate Output</button>

        <div class="output-box">
            Output: <span id="outputDisplay">-</span>
        </div>

    </div>

    <div class="card">

        <h3>üß† Write Your Logic</h3>

        <textarea id="logicBox"
        placeholder="Write your expression using x or x,y..."></textarea>

        <button class="submit-btn" onclick="submitLogic()">Submit Logic</button>

    </div>

</div>


<script>

const API = "http://localhost:5000/api/game";

let sessionId = null;
let endTime = null;
let variableCount = 1;


// üîµ PAGE LOAD
window.onload = async function() {

    const startResponse = await fetch(`${API}/start`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            team_name: "Team1",
            round: 1
        })
    });

    const data = await startResponse.json();

    // üî¥ If eliminated already
    if (data.status === "blocked") {
        alert("You are eliminated!");
        window.location.href = "leaderboard.html";
        return;
    }

    // üî¥ If already completed
    if (data.status === "already_completed") {
        window.location.href = "leaderboard.html";
        return;
    }

    sessionId = data.session_id;
    variableCount = data.variables;
    endTime = new Date(data.end_time);

    // Show second input if needed
    if (variableCount === 2) {
        document.getElementById("input2").style.display = "block";
    }

    startTimer();
};


// üî¥ STRICT TAB SWITCH ‚Äì 0 TOLERANCE
document.addEventListener("visibilitychange", async function () {

    if (!sessionId) return;

    if (document.hidden) {

        document.removeEventListener("visibilitychange", arguments.callee);

        await fetch(`${API}/force-eliminate`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                session_id: sessionId
            })
        });

        showModal(
            "‚ùå You Are Eliminated!",
            "Tab switching is not allowed.",
            "leaderboard.html"
        );
    }
});




// üîµ GENERATE OUTPUT
async function generateOutput() {

    const input1 = document.getElementById("input1").value;
    const input2 = document.getElementById("input2").value;

    let finalInput;

    if (variableCount === 2) {
        finalInput = input1 + " " + input2;
    } else {
        finalInput = input1;
    }

    const response = await fetch(`${API}/test`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            session_id: sessionId,
            input: finalInput
        })
    });

    const data = await response.json();

    if (data.output !== undefined) {
        document.getElementById("outputDisplay").innerText = data.output;
    } else {
        document.getElementById("outputDisplay").innerText = "Error";
    }
}


async function submitLogic() {

    const logic = document.getElementById("logicBox").value;

    const response = await fetch(`${API}/submit`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            session_id: sessionId,
            answer: logic
        })
    });

    const data = await response.json();
console.log("Submit response:", data);

    if (data.result && data.result.toLowerCase() === "correct")
 {

        showModal(
            "Submit Round 1?",
            "Move to Round 2 now?",
            "round2.html"
        );

    } else {

        showModal(
            "Eliminated!",
            "You are eliminated from the game.",
            "leaderboard.html"
        );
    }
}


// üîµ TIMER
function startTimer() {

    const timer = document.getElementById("timer");

    const interval = setInterval(() => {

        const now = new Date();
        const diff = endTime - now;

        if (diff <= 0) {
            
            clearInterval(interval);
            showModal(
    "Time Over!",
    "Your time has expired.",
    "leaderboard.html"
);

            return;
        }

        const m = Math.floor(diff / 60000);
        const s = Math.floor((diff % 60000) / 1000);

        timer.innerText =
            `‚è±Ô∏è ${m}:${s < 10 ? "0" : ""}${s}`;

    }, 1000);
}
function showModal(title, message, redirectUrl) {

    document.getElementById("modalTitle").innerText = title;
    document.getElementById("modalMessage").innerText = message;

    const modal = document.getElementById("resultModal");
    modal.style.display = "flex";

    document.getElementById("confirmBtn").onclick = function() {
        window.location.href = redirectUrl;
    };
}


function closeModal() {
    document.getElementById("resultModal").style.display = "none";
}

</script>

<!-- üîµ RESULT MODAL -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <p id="modalMessage"></p>

        <div style="margin-top:20px;">
    <button class="modal-confirm" id="confirmBtn">Continue</button>
</div>

    </div>
</div>

</body>

</html>
